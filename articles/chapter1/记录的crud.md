<p>
    记录的增删改查<br/>
</p>
<p>
    <strong>记录的增加</strong><br/>
</p>
<p>
    <strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</strong>插入操作，正如前文所说，数据库的数据可以看成一长串的数据流，插入操作需要滑动后续数据，将新的数据写入空位。这时，为了防止出现滑动过大的情况，我们就用到了之前提到的段页式结构，我们需要在记录的首部维护一个偏移量表，使用指针指向每条记录，然后之后的每次读写都以“块”或者“页”为单位进行读写，那么我们在中间插入时就可以不用滑动后边的所有数据了，只需要维护好段页表即可。<strong><br/></strong>
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;细说一点，插入也是分情况的，如果本块未满，那么很容易，直接重写即可，如果本块满了呢，因为块的大小是确定的（如果我没记错的innodb中的大小是16k），那么就需要将最后一条或几条数据移出到另一个块，那么问题来了，假设下一个块只能再多装一条呢？假设下一块彻底满了呢？一个简单的解决办法是创建溢出块，也就是直接在文件末尾增加一个块，然后过一段时间后让后台线程执行重排序，保证物理有序性，这样虽然在短时间内会让段表以及物理结构看起来稍有混乱，但这样做无疑会增加大量插入时的效率。<br/>
</p>
<p>
    <strong>记录的删除</strong>
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;同插入一样，删除操作也存在许多值得注意的地方，比如我们并不需要每次重写块，而是维护一个删除标记，来记录此条记录是否可用，同时在块头维护一张可用空间表，用来告诉我们此块能够写入多少条数据。<br/>
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;简单来说，io是一个珍贵的操作，我们的一切行为都要以尽量减少io为最终目的。<br/>
</p>
<p>
    <strong>记录的修改</strong>
</p>
<p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修改操作也是一样的，看似修改对整个系统毫无影响，最多更新一下缓存系统中的脏页，但仍然是要考虑很多情况的，比如变长记录的修改，是否需要触发滑动数据，再难办一点，增加了数据会不会导致这个块无法装下本条数据，这时应该如果处理，就会是一个很令人头疼的问题了。但其实逻辑理清后，处理方法也是比较简单粗暴，我们只需要在块中移动元素或者创建新快，就像增加时那样，若修改使得记录变短，则可以像删除记录那样恢复、合并空间。
</p>